# AI 审计方案 - 升级后预初始化阶段权限过渡

## 背景
`audit_001_021_plan_report.md` 指出升级完成后旧状态不会被自动清理，但未确认是否构成漏洞，当前等待人工验证。结合此前的误报记录，本次计划进一步关注 **升级完成到重新初始化之间的时间窗口**。在此阶段，`is_initialised` 为 `False`，但旧角色等状态仍然存在，可能被用于修改权限或执行关键操作。

## 目标
1. 统计所有在未初始化状态下仍可调用的 ABI 方法。
2. 分析旧角色是否能在此阶段授予新角色或影响升级流程。
3. 构建测试场景：完成升级后暂不初始化，尝试调用 `grant_role`、`schedule_contract_upgrade` 等方法。
4. 根据结果给出是否需要在升级后立即初始化或限制调用的建议。

## 审计范围
- `contracts/library/Upgradeable.py`
- `contracts/library/AccessControl.py`
- 相关扩展与示例合约

## 方法与步骤
1. **代码审查**
   - 搜索库内所有 ABI 方法，标记未调用 `_only_initialised` 的函数。
   - 重点检查这些函数在升级后未初始化状态下的影响。
2. **测试设计**
   - 部署旧版本合约，授予多个角色后完成升级。
   - 在不调用 `initialise` 的情况下尝试修改角色或重新调度升级。
3. **文档检查**
   - 查阅 README 与 DeepWiki（如可访问），确认是否建议在升级后立即初始化或限制其他调用。

## 预期输出
- 列出未受初始化保护的接口及其潜在风险。
- 若风险可忽略，将计划标记为人工否定；否则提出具体的限制或文档改进方案。

> 注：本文件仅为审计计划，未执行实际审计工作。
