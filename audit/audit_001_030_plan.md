# AI 审计方案 - BoxMap 条目数量上限与潜在 DoS

## 背景
- 根据 `audit_001_023_plan_report.md`、`audit_001_025_plan_report.md`、`audit_001_028_plan_report.md` 与 `audit_001_029_plan_report.md`，此前关注的前缀冲突、状态兼容性、程序页数和 `default_admin_role` 冲突等方向均被人工否定。
- `audit_001_020_plan_report.md` 与 `audit_001_024_plan_report.md` 指出升级后角色持久化和版本回滚属于治理风险，但未构成直接漏洞。
- `audit_001_026_plan_report.md` 的验证结果尚未出炉，为避免重复工作，本次计划探索新的切入点。

## 新方向
Algorand 应用的 Box 数量存在协议上限（当前为 65536 个），每个 Box 占用账户余额。`AccessControl` 与 `RateLimiter` 均使用 `BoxMap` 存储角色或桶信息，但未限制条目数量。若外部接口允许任意创建新角色或桶，攻击者可能批量调用以消耗应用余额或达到 Box 上限，导致后续正常操作失败，形成拒绝服务。

## 目标
1. 确认库中暴露的接口是否允许任何账户添加角色或桶，以及是否附带权限检查。
2. 估算在极端情况下创建大量 Box 所需的最低余额，评估 DoS 难度。
3. 审查文档和示例合约，了解官方是否给出条目数量或权限方面的限制建议。

## 方法与步骤
1. **代码审查**
   - 搜索 `BoxMap` 的 `_add_bucket`、`_grant_role` 等写入逻辑，记录是否有访问控制。
   - 统计每个条目写入的字节数，推算创建大量条目的成本。
2. **理论分析**
   - 结合当前协议对 Box 总数和单应用余额的限制，估算达到上限所需的调用次数与费用。
3. **文档检查**
   - 查阅 `README.md` 及 DeepWiki（若可访问），确认是否提及 Box 数量管理策略。

## 预期输出
- 若发现缺乏权限检查或成本极低，应提出限制条目数量或增加费用的方案。
- 若成本较高且接口受限，则记录为“未发现漏洞”，并总结应在文档中提醒开发者预留余额。

> 注：本文件仅为审计计划，尚未执行实际审计工作。
