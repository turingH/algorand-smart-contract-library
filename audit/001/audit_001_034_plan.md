# AI 审计方案 - 升级后 upgradable_admin_role 常量变更风险

## 背景
- `audit_001_033_plan_report.md` 仅指出 BoxMap 结构变更在升级中可能造成数据误读，属治理層面風險。
- 历次审计均表明核心逻辑未见严重漏洞，但 `audit_001_020_plan_report.md` 等提及角色数据在升级后仍会保留，可能造成权限管理隐患。
- 若新版本修改了 `Upgradeable.upgradable_admin_role()` 的常量（例如更换哈希字符串），旧持有者将不再拥有对应角色。若此时无人持有 `default_admin_role`，则无法再授予新角色，导致合约失去升级能力。

## 新方向
研究升级到使用不同 `upgradable_admin_role` 常量的合约版本时，是否会因旧角色失效而无法继续管理升级。该问题尚未在既有计划中深入讨论，可能造成永久锁定或需依赖外部脚本恢复权限。

## 目标
1. 梳理 `Upgradeable.upgradable_admin_role` 的实现，确认常量来源及是否允许覆盖。
2. 设计测试：
   - 部署初始版本并授予账户 `UPGRADEABLE_ADMIN_ROLE`。
   - 升级到修改常量的新版本，且无账户持有 `default_admin_role`。
   - 尝试再次调度升级或授予新角色，观察权限是否丢失。
3. 检查 README 与 DeepWiki 是否提醒开发者避免更换该常量或在升级前预留管理员。

## 方法与步骤
1. **代码审查**
   - 查看 `Upgradeable.upgradable_admin_role()` 及相关调用，确认常量生成方式。
   - 搜索仓库判断是否存在自定义字符串或可配置途径。
2. **测试设计**
   - 编写示例合约 `UpgradeableV2`，仅修改常量字符串。
   - 通过脚本模拟升级并记录结果。
3. **文档检查**
   - 查阅仓库文档与 DeepWiki（若可访问），确认是否有更换角色常量的警告或迁移流程。

## 预期输出
- 若确认更换常量会导致无法再次升级，需在文档中强调保持常量一致或在升级前授予 `default_admin_role` 以便恢复权限。
- 若影响较小，可标记为治理风险并给出最佳实践建议。

> 注：本文件仅为审计计划，未执行实际审计工作。
