# AI 审计方案 - RateLimiter 桶重建导致配额重置风险
## 更新历史
- 2025-07-08: 基于 @audit_001_report_change_01.md、@audit_001_report.md、@audit_001_006_plan_report.md 等误报确认文件，本方案被人工否定，不再继续深挖。新审计方向详见 audit_001_010_plan.md。
- 2025-07-09: 结合 @audit_001_access_control_plan_report.md 与 @audit_001_006_plan_report.md 的结果，确认旧方向均为误报。本方案再次停止，新的研究方向转向 UInt64SetLib 边界条件，详见 audit_001_011_plan.md。
- 2025-07-10: audit_001_010_plan_report.md 未发现漏洞，确认此前假设不成立。
- 2025-07-11: audit_001_011_plan_report.md 未发现漏洞，原方案被人工否定。
- 2025-07-12: 新方向转向 Upgradeable 合约程序哈希校验，详见 audit_001_012_plan.md。
- 2025-07-13: audit_001_012_plan_report.md 未发现漏洞，确认 Upgradeable 哈希校验方向为误报，标记为人工否定。新的研究方向转向升级时间戳溢出问题，详见 audit_001_013_plan.md。
- 2025-07-14: audit_001_013_plan_report.md 未发现漏洞，再次确认前述假设均为误报。继续寻找新的研究方向。
- 2025-07-15: 基于上述结论，决定审查 AccessControl 角色 ID 的 16 字节截断设计，以评估潜在碰撞风险，计划文件为 audit_001_014_plan.md。
- 2025-07-16: audit_001_014_plan_report.md 未发现漏洞，方向被人工否定。新方向关注 RateLimiter 桶管理及存储成本，计划文件为 audit_001_015_plan.md。
- 2025-07-17: audit_001_015_plan_report.md 证实桶管理与存储成本仅属设计考量，无安全漏洞，方向被人工否定。新的研究方向转向桶删除后立即重新创建是否可重置配额，计划文件为 audit_001_016_plan.md。


## 背景
此前围绕桶管理与存储成本的审计在 `audit_001_015_plan_report.md` 中被确认仅属设计考量。为继续寻找潜在风险，本方案改为研究 **删除后重新创建桶是否可以重置配额**。根据 `pk.md` 的先验知识，`_update_capacity` 等数值逻辑已被验证安全，本计划不再重复审计这些部分。

## 审计目标
1. 验证 `_remove_bucket` 后立即 `_add_bucket` 是否会令 `current_capacity` 与 `last_updated` 重置为初始值，从而绕过原有配额。
2. 调查库中或示例合约是否公开这些接口且缺乏权限保护，可能被滥用来规避限流。
3. 根据审查结果提出是否需要事件记录或删除冷却期等改进建议。

## 审计步骤
1. **代码审查**
   - 阅读 `_remove_bucket` 与 `_add_bucket` 的实现，确认删除操作是否完全清理数据，重新创建时容量与时间戳如何初始化。
   - 搜索仓库中对这些函数的调用位置，记录是否受 AccessControl 等权限保护。
2. **测试设计**
   - 构造场景：先消耗部分容量，随后删除并立即重新创建同一 `bucket_id`，观察配额是否被重置以及操作成本。
3. **接口与权限检查**
   - 审阅示例合约和公开 ABI，确认外部能否直接调用上述函数，及其权限约束情况。
4. **改进建议**
   - 如有需要，提出记录历史配额或设置删除冷却期的思路，仅供参考。

## 预期结果
- 说明桶删除后重新创建是否会导致配额立即恢复及其安全影响。
- 若未发现风险，记录结论并在文档中补充对该行为的说明。
