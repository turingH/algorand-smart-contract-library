# AI 审计方案 - AccessControl 角色 ID 碰撞风险

## 背景
- `AccessControl` 通过 `keccak256` 哈希截断前 16 字节来生成角色 ID。
- 随着合约功能扩展，可能需要大量不同的角色，理论上存在哈希碰撞的概率。
- 先前的审计方向均被人工否定，现转向评估角色 ID 设计的安全性与可扩展性。

## 目标
1. 统计库中所有角色常量与 ABI 方法生成的角色 ID，验证是否存在重复。
2. 估算在 16 字节截断下的碰撞概率，结合预期角色数量评估风险。
3. 提出在库或文档中记录原始角色字符串或扩展 ID 长度的可行性建议。

## 审计范围
- `contracts/library/AccessControl.py` 及其测试合约。
- 所有使用 `keccak256(...)[0:16]` 生成角色 ID 的代码路径。

## 方法与步骤
1. **代码审查**
   - 搜索 `keccak256` 调用并记录生成 ID 的源字符串。
   - 检查是否有硬编码的角色常量共享同一字符串或截断结果。
2. **碰撞概率分析**
   - 假设角色数量上限为 `n`，计算 `2^128` 空间下的生日悖论碰撞概率。
   - 结合实际需要的角色数给出风险级别评估。
3. **改进方案调研**
   - 比较使用更长哈希或直接存储完整字符串的成本。
   - 评估记录角色原始名称以供去重的可行性。

## 预期输出
- 角色 ID 列表及是否存在冲突的结论。
- 碰撞概率计算及对安全性的影响评估。
- 如有必要，提出扩展角色 ID 或记录原始字符串的改进建议。

> 注：本文件仅为审计计划，尚未执行实际审计工作。
