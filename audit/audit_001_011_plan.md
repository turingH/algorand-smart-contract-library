# AI 审计方案 - UInt64SetLib 边界条件与性能

## 背景
`contracts/library/UInt64SetLib.py` 提供对 `UInt64` 集合的增删查操作，内部使用 `DynamicArray` 存储，官方文档指出单个数组最多支持 511 项。本计划旨在验证在极端容量下的正确性与成本，避免在大规模使用场景中出现越界或性能问题。

## 目标
1. 验证 `add_item`、`remove_item`、`has_item` 在集合接近 511 项时的表现。
2. 评估在最坏情况下执行这些操作的最大栈深和手续费消耗。
3. 确认集合长度限制是否会导致不可预期的失败或数据丢失。
4. 提出在库层或文档中需补充的使用建议。

## 审计范围
- `contracts/library/UInt64SetLib.py`
- 任何依赖该库的示例合约 `contracts/library/test/UInt64SetLibExposed.py`

## 方法与步骤
1. **代码静态审查**
   - 阅读函数实现，确认对 `DynamicArray.length` 的假设和潜在越界点。
2. **单元测试设计**
   - 构造最大长度 (511) 的集合，分别测试添加已存在元素、添加新元素和删除元素的行为。
   - 观察返回值与数组内容是否符合预期。
3. **性能评估**
   - 使用 Algopy 生成的 TEAL，估算每个操作在最大长度下的栈深和指令数。
4. **文档检查**
   - 核对库代码与 README 是否明确指出长度限制及相关成本，如无则在报告中提出改进建议。

## 预期输出
- 测试脚本与结果记录。
- 最高栈深与估算的手续费表格。
- 若无漏洞，给出使用限制和优化建议。

> 注：本文件仅为审计计划，尚未执行实际审计工作。
