# AI 审计方案 - RateLimiter 桶重建导致配额重置风险

## 背景
`audit_001_015_plan_report.md` 证明桶管理与存储成本本身并无安全问题。为继续探索潜在风险，本计划聚焦于删除后立即重新创建桶是否能绕过配额限制。依据 `pk.md` 中的先验知识，关于 `_update_capacity` 的数值安全和时间更新逻辑已被确认，无需重复审计。

## 目标
1. 证明或否定通过 `_remove_bucket` 后再 `_add_bucket` 是否会使 `current_capacity` 与 `last_updated` 重置，导致可立即再次消费。
2. 搜索仓库中可能暴露这些内部函数的接口，检查是否存在缺乏权限保护的实现。
3. 在测试环境中复现此流程，评估操作成本及可行性。
4. 如无风险，记录结论；如存在潜在问题，提出事件记录或删除冷却期等缓解建议。

## 审计范围
- `contracts/library/RateLimiter.py` 中与添加、删除桶相关的内部函数实现。
- 依赖该库并可能暴露相应接口的示例合约，如 `RateLimiterExposed` 等。

## 方法与步骤
1. **代码审查**
   - 阅读 `_remove_bucket` 和 `_add_bucket` 的逻辑，确认删除是否彻底清除 Box 状态，再创建时容量与时间戳如何赋值。
   - 结合 `RateLimiterExposed` 等测试合约，查找可能的外部入口及权限限制。
2. **单元测试设计**
   - 构建测试：创建桶并消耗部分容量 → 删除桶 → 立即重新创建同一 `bucket_id` → 查询容量和 `last_updated`。
   - 若 `last_updated` 被重置且容量恢复至 `limit`，则说明存在配额重置现象。
3. **权限与文档检查**
   - 审阅示例或文档，确认库作者是否提醒开发者在暴露这些接口时应加权限控制或日志记录。
4. **风险评估与建议**
   - 若行为被证明可能被恶意利用，提出在文档中加入警告或增加冷却期、历史记录等方案。

## 预期输出
- 对删除并重新创建桶后配额状态的详细实验记录。
- 对公开接口的权限分析结果及改进建议。
- 若确认无风险，将该方向标记为“人工否定”，并结束该线索的后续审计。
